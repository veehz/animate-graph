<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="../../dist/animate-graph.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="../../dist/animate-graph.umd.js"></script>
    <script src="https://veehz.github.io/torch/build/browser/torch.browser.umd.js"></script>
</head>
<body>
    <div id="controls" style="margin-bottom: 10px;">
        <!-- Slider will be injected here -->
    </div>
    <div id="graph-container" style="border: 1px solid #ccc; height: 600px;"></div>
    <script>
        const { Graph, Node, Animator, Slider } = AnimateGraph;
        const torch = window.torch;


        for(const event of Object.values(torch.events)) {
            torch.eventBus.addEventListener(event, (e) => {
                console.log(event, e);
            });
        }

        const a = new torch.Tensor([1, 2, 3], { requires_grad: true });
        console.log(a);

        const b = new torch.Tensor([4, 5, 6], { requires_grad: true });
        console.log(b);

        const c = a.add(b);
        console.log(c);
        
        const d = c.sum();
        d.backward();

        const animator = new Animator();
        const slider = new Slider("#controls", animator);

        const graph = new Graph("#graph-container", {
            height: document.getElementById("graph-container").clientHeight,
            width: document.getElementById("graph-container").clientWidth
        });

        const nodeA = new Node("n-a", "A");
        const nodeB = new Node("n-b", "B");
        graph.insertNode(nodeA);
        graph.insertNode(nodeB);

        animator.snap(graph);

        setTimeout(() => {
            const nodeC = new Node("n-c", "C");
            graph.insertNodeAfter(nodeC, [nodeA, nodeB]);
            console.log("Added Node C -> [A, B]");
            animator.snap(graph);
        }, 100);

        setTimeout(() => {
            const nodeD = new Node("n-d", "D");
            graph.insertNodeAfter(nodeD, [nodeA, nodeB]);
            console.log("Added Node D -> [A, B]");
            animator.snap(graph);
        }, 200);

        setTimeout(() => {
            const nodeE = new Node("n-e", "E");
            graph.insertNodeAfter(nodeE, [nodeB]);
            console.log("Added Node E -> [B]");
            animator.snap(graph);
        }, 300);

        setTimeout(() => {
            const nodeF = new Node("n-f", "F");
            graph.insertNodeAfter(nodeF, ["n-d", "n-e"]);
            console.log("Added Node F -> [D, E]");
            animator.snap(graph);
            animator.last();
        }, 400);
    </script>
</body>
</html>
